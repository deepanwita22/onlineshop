#include<iostream.h>
#include<string.h>
#include<time.h>
#include<conio.h>
#include<process.h>
#include<stdio.h>
#include<fstream.h>
class user
{
 long int orderno;
 char name[50];
 char gender;
 char username[50];
 int age;
 char address[150];
 char email[50];
 long int mobileno;
 char password[15];
 char feedback[100];
 public:
 void output()
 {
  cout<<"\n NAME           :"<<name;
  cout<<"\n USERNAME       :"<<username;
  cout<<"\n AGE            :"<<age;
  cout<<"\n GENDER         :"<<gender;
  cout<<"\n ADDRESS        :"<address;
  cout<<"\n MOBILE NO.     :"<<mobileno;
  cout<<"\n EMAIL ADDRESS  :"<<email;
 }
 void input()
 {
  cout<<"\n\n ENTER NAME        : "; gets(name);
  cout<<" ENTER AGE         : "; cin>>age;
  cout<<" ENTER GENDER (M/F): "; cin>>gender;
  cout<<" ENTER ADDRESS     : "; gets(address);
  cout<<" ENTER CONTACT	    : "; cin>>mobileno;
  cout<<" ENTER USERNAME    : " ;gets(username);
  cout<<" ENTER EMAIL ID    : "; gets(email);
  cout<<" ENTER PASSWORD    : "; gets(password);
 }
 int uname_check(char uname[])
 {
  int ans;
  ans = strcmpi(uname,username);
  return ans;
 }
 int pswrd_check(char pass[])
 {
  int ans;
  ans = strcmpi(password,pass);
  return ans;
 }
 void disp_feedback()
 {
  cout<<"\n\nUsername:"<<username;
  cout<<"\nFeedback:"<<feedback;
 }
 void acc_feedback(char usr[20])
 {
  cout<<"\n\nEnter the Feedback:";
  gets(feedback);
  strcpy(username,usr);
 }
}U;
void user_ins()   //consumer
{
 ofstream fio;
 fio.open("user.dat",ios::out|ios::binary|ios::app);
 U.input();
 fio.write((char*)&U,sizeof(U));
 fio.close();
 time_t rawtime;
 time (&rawtime);
 printf("\nYour account was succesfully created at %s", ctime(&rawtime));
}
void user_dtls()  //consumer
{
 ifstream fin;
 fin.open("user.dat",ios::in|ios::binary);
 fin.read((char*)&U,sizeof(U));
 U.output();
 fin.close();
}
struct items_store
{
 char product[20];
 char type[20];
 float price;
 int qty_avai;
};
struct items_cust
{
 char username[20];
 char product[20];
 char type[20];
 float price;
 int qty_req;
};
struct order
{
 int odrno;
 items_cust I[10];
 float ttlprice;
};
void rev_feedback()  //admin
{
 ifstream fin;
 fin.open("Feedback.dat",ios::in|ios::binary);
 if(!fin)
  cout<<"\n\n\nERROR!!!! FILE NOT FOUND !";
 while(fin)
 {
  fin.read((char*)&U,sizeof(U));
  if(fin.eof())
   break;
  U.disp_feedback();
 }
}
void Add_Products()    //administrator
{
 items_store S;
 ofstream fout("Product.dat",ios::out|ios::app);
 cout<<"\n Enter the details-\n\n";
 cout<<"Product:";
 cin>>S.product;
 cout<<"Type:";
 cin>>S.type;
 cout<<"Price:";
 cin>>S.price;
 cout<<"Quantity Available:";
 cin>>S.qty_avai;
 fout.write((char*)&S,sizeof(S));
 cout<<"\n\nITEM SUCCESSFULLY ADDED!!!";
 fout.close();
}
void products()   //admin
{
 clrscr();
 items_store s;
 ifstream fin;
 fin.open("Product.dat",ios::in|ios::binary);
 fin.seekg(0);
 cout<<"\n\n--------------------------------------------------------------------------------";
 cout<<"\n\n\t\t\tPRODUCT MENU";
 cout<<"\n--------------------------------------------------------------------------------";
 cout<<"\n\n\tPRODUCT\t\tTYPE\t\tPRICE\t\tQUANTITY\t\t\n";
 while(fin)
 {
  if(!fin)
   cout<<"\n\nERROR FILE NOT FOUND";
  fin.read((char*)&s,sizeof(s));
  if(fin.eof())
  break;
  cout<<"\n\t"<<s.product<<"\t\t"<<s.type<<"\t\t"<<s.price<<"\t\t"<<s.qty_avai;
 }
 fin.close();
 cout<<"\n\n--------------------------------------------------------------------------------";
 cout<<"\n\n\n\nDo you want to update any product?   (Yes/No) : ";
 char ans[3];
 gets(ans);
 if(strcmpi(ans,"yes")==0)
 {
  clrscr();
  cout<<"--------------------------------------------------------------------------------";
  cout<<"\n\n\t\t\t\tUPDATE PRODUCT\n\n";
  cout<<"\n--------------------------------------------------------------------------------";
  char product[20];
  int pos;
  fstream file;
  file.open("Product.dat", ios::in|ios::out|ios::binary);
  file.seekg(0);
  cout<<"\n\nEnter the product name:";
  gets(product);
  cout<<"\n\tPRODUCT\t\tTYPE\t\tPRICE\t\tQUANTITY\t\t\n";
  while(!file.eof())
  {
   pos=file.tellg();
   file.read((char*)&s,sizeof(s));
   if(strcmpi(product,s.product)==0)
   {
     cout<<"\n\t"<<s.product<<"\t\t"<<s.type<<"\t\t"<<s.price<<"\t\t"<<s.qty_avai;
     cout<<"\n\n\nEnter the diiferent quantity:";
     cin>>s.qty_avai;
     file.seekp(pos,ios::beg);
     file.write((char*)&s,sizeof(s));
     clrscr();
     cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t   ITEM UPDATED!!!";
     return;
   }
  }
   file.close();
 }
}
void disp_cart_dtls(char uname[20])  //consumer
{
 items_cust c;
 int total_price=0;
 ifstream fin;
 fin.open("cart.dat",ios::in|ios::binary);
 if(!fin)
  cout<<"\n\nERROR!!! FILE NOT FOUND!";
 cout<<"\n\nPRODUCT\t\tTYPE\t\tPRICE\t\tQUANTITY\t\t\n";
 while(fin)
 {
  fin.read((char*)&c, sizeof(c));
  if(fin.eof())
   break;
  if(strcmpi(c.username,uname)==0)
  {
   cout<<"\n"<<c.product<<"\t\t"<<c.type<<"\t\t"<<c.price<<"\t\t"<<c.qty_req;
   total_price+=(c.price*c.qty_req);
  }
 }
 cout<<"\nTotal Price :"<<total_price;
 fin.close();
}
void placeorder(char uname[])     //consumer
{
 ifstream fin;
 ifstream fin2;
 ofstream fout;
 fout.open("order.dat",ios::out|ios::app|ios::binary);
 fin.open("cart.dat",ios::in|ios::binary);
 fin2.open("User.dat",ios::in|ios::binary);
 clrscr();
 items_cust c;
 if(!fin)
  cout<<"\n\nERROR FILE NOT FOUND";
 while(fin)
 {
  fin.read((char*)&c,sizeof(c));
  if(strcmpi(c.username,uname)==0)
  {
   fin2.read((char*)&U,sizeof(U));
   if((U.uname_check(uname)==0))
   {
    cout<<"\n\n\t\tUSER DETAILS\n\n";
    U.output();
    cout<<"\n\nCART DETAILS";
    disp_cart_dtls(uname);
    cout<<"\n\nPlace Order?";
    char ans[5];
    gets(ans);
    if(strcmpi(ans,"yes")==0)
    {
     fout.write((char*)&c,sizeof(c));
     time_t rawtime;
     time (&rawtime);
     printf("\nYour order was succesfully placed at %s", ctime(&rawtime));
     return;
    }
   }
  }
 }
}
void Item_Menu(char uname[])  //customer
{
 ifstream fin;
 fin.open("Product.dat",ios::in|ios::binary);
 items_store S;
 items_cust C;
 ofstream fout;
 fout.open("cart.dat",ios::out|ios::app|ios::binary);
 fin.seekg(0);
 cout<<"\n\t-----------------------------------------------------------------------";
 cout<<"\n\t\t\t\t    PRODUCT MENU";
 cout<<"\n\t-----------------------------------------------------------------------";
 cout<<"\n\n\t\t\tPRODUCT\t\tTYPE\t\tPRICE\n";
 while(fin)
 {
  fin.read((char*)&S,sizeof(S));
  if(fin.eof())
   break;
  cout<<"\n\t\t\t"<<S.product<<"\t\t"<<S.type<<"\t\t"<<S.price;
 }
 fin.close();
 char ans[3];
 cout<<"\n\n\t-----------------------------------------------------------------------";
 cout<<"\n\n\t\t\tDo You Want to Buy? (Yes/No)\t:";
 gets(ans);
 if(strcmpi(ans,"yes")==0)
 {
  char product[20];
  ifstream file;
  file.open("Product.dat", ios::in|ios::binary);
  file.seekg(0);
  clrscr();
  cout<<"\n\n\n\n\t\tEnter the product name:";
  gets(product);
  while(!file.eof())
  {
   file.read((char*)&S,sizeof(S));
   if(strcmpi(product,S.product)==0)
   {
    cout<<"\n\n\t\tEnter the quantity required-"; cin>>C.qty_req;
    strcpy(C.product,S.product);
    strcpy(C.type,S.type);
    C.price=S.price;
    S.qty_avai-=C.qty_req;
    strcpy(C.username,uname);
    if(S.qty_avai<C.qty_req)
    {
     cout<<"\nSorry, not enough stock available.";
     return;
    }
    else
    {
     fout.write((char*)&C,sizeof(C));
     cout<<"\n\n\t\t\t    ADDED TO CART";
     return;
    }
   }
  }
 file.close();
 }
 fin.close();
 fout.close();
}
void Shop_Cart(char uname[])  //customer
{
 ifstream fin;
 fin.open("cart.dat",ios::in|ios::binary);
 if(!fin)
  cout<<"\n\n\n\n\nERROR!!! NO FILE!!!";
 items_cust c;
 cout<<"\n\n\t\tPRODUCT\t\tTYPE\t\tPRICE\t\tQUANTITY";
 while(fin)
 {
   fin.read((char*)&c,sizeof(c));
   if(strcmpi(uname,c.username)==0)
   {
    if(fin.eof())
    break;
    cout<<"\n\n\t\t"<<c.product<<"\t\t"<<c.type<<"\t\t"<<c.price<<"\t\t"<<c.qty_req;
   }
 }
 cout<<"\n\n\t-------------------------------------------------------------------";
 cout<<"\n\n\t\tDo you want to Place the Order?   (Yes/No) : ";
 char ch[3];
 gets(ch);
 if(strcmpi(ch,"yes")==0)
  placeorder(uname);
 fin.close();
}
void cons_feedback(char usr[20]) //consumer
{
 U.acc_feedback(usr);
 ofstream fout;
 fout.open("Feedback.dat",ios::out|ios::app|ios::binary);
 if(!fout)
  cout<<"\n\nError!!! FILE NOT FOUND";
 fout.write((char*)&U, sizeof(U));
 cout<<"\n\nFEEDBACK UPDATED! THANK YOU FOR YOUR PATRONAGE";
 fout.close();
}
void Admin(char usr[20])
{
 clrscr();
 int opt;
 cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\tWelcome "<<usr;
 getch();
 do
 {
  clrscr();
  cout<<"\n\t-------------------------------------------------------------------";
  cout<<"\n\t\t\t\tWELCOME \t"<<usr;
  cout<<"\n\t-------------------------------------------------------------------";
  cout<<"\n\n\tHere Are Your Options :-";
  cout<<"\n\n\t1.Review Orders";
  cout<<"\n\t2.Check and Update Products";
  cout<<"\n\t3.Add Products";
  cout<<"\n\t4.Return to Title Screen";
  cout<<"\n\n\t-------------------------------------------------------------------";
  cout<<"\n\n\tEnter your choice:";
  cin>>opt;
  switch(opt)
  {
   case 1:{
	   clrscr();
	   cout<<"\n\nRead Feedbacks";
	   rev_feedback();
	   break;
	  }
   case 2:{
	   clrscr();
	   cout<<"\n\nCheck Products and Update";
	   products();
	   break;
	  }
   case 3:{
	   clrscr();
	   Add_Products();
	   break;
	  }
   case 4:{
	   clrscr();
	   cout<<"\n\n\n\n\n\n\n\n\n\n\t\t  THANK YOU "<<usr<<" FOR COMING. SEE YOU AGAIN!";
	   return;
	  }
  }getch();
 }while(1);
}
void Consumer(char uname[])  //consumer
{
 clrscr();
 int opt;
 cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\tWelcome "<<uname;
 getch();
 do
 {
  clrscr();
  cout<<"\n\t\t-------------------------------------------------------";
  cout<<"\n\n\t\t\t\tWELCOME "<<uname;
  cout<<"\n\t\t-------------------------------------------------------";
  cout<<"\n\n\t\tHere Are Your Options :-";
  cout<<"\n\n\n\t\t1.Item Menu";
  cout<<"\n\n\t\t2.Shopping Cart";
  cout<<"\n\n\t\t3.Enter Feedback";
  cout<<"\n\n\t\t4.Return to Title Screen";
  cout<<"\n\t\t-------------------------------------------------------";
  cout<<"\n\t\tEnter your Choice:";
  cin>>opt;
  switch(opt)
  {
   case 1:{
	   clrscr();
	   Item_Menu(uname);
	   break;
	  }
   case 2:{
	   clrscr();
	   cout<<"\n\t-------------------------------------------------------------------";
	   cout<<"\n\n\t\t\t\t    Shopping Cart";
	   cout<<"\n\t-------------------------------------------------------------------";
	   Shop_Cart(uname);
	   break;
	  }
   case 3:{
	   clrscr();
	   cout<<"\n\n\t\tFeedback";
	   cons_feedback(uname);
	   break;
	  }
   case 4:{
	   clrscr();
	   cout<<"\n\n\n\n\n\n\n\n\n\n\t\t  THANK YOU "<<uname<<" FOR COMING. SEE YOU AGAIN!";
	   return;
	  }
  }getch();
 }while(1);
}
void Cons_login()        //consumer
{
 char uname[20],password[20],password1[20];
 clrscr();
 cout<<"\n\t\t-------------------------------------------------------";
 cout<<"\n\t\t\t\t\tLOGIN";
 cout<<"\n\t\t-------------------------------------------------------";
 cout<<"\n\n\n\n\t\t\tUSERNAME:";
 gets(uname);
 char x;
 int got=0,name,pass;
 cout<<"\n\n\t\t\tPASSWORD:";
 for(int i=0;i<20;i++)
 {
  x=getch();
  password[i]=x;
  if(x==13)
   break;
  cout<<"*";
 }
 ifstream fin;
 fin.open("user.dat",ios::in|ios::binary);
 while(fin)
 {
  fin.read((char*)&U, sizeof(U));
  name=U.uname_check(uname);
  pass=U.pswrd_check(password)+13;
  if((name==0)&&(pass==0))
  {
   Consumer(uname);
   got++;
   break;
  }
 }
 fin.close();
 if(got==0)
  cout<<"\n\n\t\tWRONG LOGIN ID";
}
void main()
{
 clrscr();
 int user;
 do
 {
  clrscr();
  cout<<"\n\n\n\n\n\t\t|--------------------------------------------------|";
  cout<<"\n\t\t|\t\t    SNAPCART\t\t\t   |";
  cout<<"\n\t\t|--------------------------------------------------|";
  cout<<"\n\t\t|\t\t\t\t\t\t   |\n\t\t|\t\t\t\t\t\t   |\n\t\t|  1.ADMINISTRATOR\t2.CONSUMER\t3.Exit     |";
  cout<<"\n\t\t|\t\t\t\t\t\t   |\n\t\t|\t\t\t\t\t\t   |";
  cout<<"\n\t\t|--------------------------------------------------|";
  cout<<"\n\t\t  Which Portal Do You Want To Go To:";
  cin>>user;
  switch(user)
  {
   case 1:{
	   clrscr();
	   char username[20], password[20];
	   for(int try=0;try<5;try++)
	   {
	    clrscr();
	    cout<<"\n\t\t-------------------------------------------------------";
	    cout<<"\n\n\t\t\t\t    ADMINISTRATOR";
	    cout<<"\n\n\t\t-------------------------------------------------------";
	    cout<<"\n\n\n\n\t\t\t\tUSERNAME:";
	    gets(username);
	    cout<<"\n\t\t\t\tPASSWORD:";
	    char x;
	    for(int i=0;i<20;i++)
	    {
	     x=getch();
	     password[i]=x;
	     if(x==13)
	      break;
	     cout<<"*";
	    }
	    char password1[20];
	    int r=0;
	    if(strcmpi(username,"Himon")==0)
	    {
	     strcpy(password1,"theflash");
	     for(i=0;i<strlen(password1);i++)
	      if(password1[i]!=password[i])
	       r++;
	     if(r==0)
	     {
	      Admin(username);
	      break;
	     }
	     else
	     {
	      cout<<"\n\n\t\tWRONG PASSWORD!! PLZ TRY AGAIN";
	      getch();
	     }
	    }
	    else
	     if(strcmpi(username,"Deepanwita")==0)
	     {
	      strcpy(password1,"Anindita");
	      for(i=0;i<strlen(password1);i++)
	       if(password1[i]!=password[i])
		r++;
	      if(r==0)
	      {
	       Admin(username);
	       break;
	      }
	      else
	      {
	       cout<<"\n\n\t\tWRONG PASSWORD!! PLZ TRY AGAIN";
	       getch();
	      }
	     }
	     else
	      if(strcmpi(username,"Shubhankar")==0)
	      {
	       strcpy(password1,"LosBlancos");
	       for(i=0;i<strlen(password1);i++)
		if(password1[i]!=password[i])
		 r++;
	       if(r==0)
	       {
		Admin(username);
		break;
	       }
	       else
	       {
		cout<<"\n\n\t\tWRONG PASSWORD!! PLZ TRY AGAIN";
		getch();
	       }
	      }
	      else
	      {
	       cout<<"\n\n\t\tWRONG USERNAME!! PLZ TRY AGAIN";
	       getch();
	      }
	   }
	   break;
	  }
   case 2:{
	   clrscr();
	   cout<<"\n\t\t-------------------------------------------------------";
	   cout<<"\n\n\t\t\t\t    CONSUMER";
	   cout<<"\n\t\t-------------------------------------------------------";
	   cout<<"\n\n\n\n\t\t\t1.Sign Up\t\t\t2.Login";
	   cout<<"\n\n\t\t-------------------------------------------------------";
	   int opt;
	   cout<<"\n\n\n\t\t\tEnter your choice:";
	   cin>>opt;
	   if(opt==1)
	   {
	    char ans[20];
	    clrscr();
	    cout<<"\n\n\n\n\n\n\n\n\t\tWELL HELLO THERE! WELCOME TO SNAPCART  * press any button *";
	    getch();
	    clrscr();
	    cout<<"\n\n\n\n\n\t\t\t\tHOWS YOUR DAY";
	    cout<<"\n\n\t\tANSWER:";
	    gets(ans);
	    clrscr();
	    cout<<"\n\n\n\n\n\n\n\n\t\t\t  I SEE.     * press any button *";
	    getch();
	    clrscr();
	    cout<<"\n\n\n\n\n\n\tWHAT? DOES IT FEEL WEIRD THAT THE PROGRAM IS TALKING WITH YOU?";
	    cout<<"\n\nANSWER:";
	    gets(ans);
	    clrscr();
	    cout<<"\n\n\n\n\n\t\t\t\tHAHAHA\n\n\n\t\t\tLETS GET YOU STARTED SHALL WE?  * press any button *";
	    getch();
	    clrscr();
	    cout<<"\n\n\n\tUSER SIGN-UP\n\n";
	    user_ins();
	    break;
	   }
	   else
	    if(opt==2)
	   {
	    Cons_login();
	    break;
	   }
	   break;
	  }
   case 3:exit(0);
  }
  getch();
 }while(1);
}